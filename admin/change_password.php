<?php require_once __DIR__ . '/../inc/auth.php'; require_once __DIR__ . '/../inc/csrf.php'; require_admin();
$stmt=$pdo->prepare("SELECT * FROM admin WHERE username=? LIMIT 1"); $stmt->execute([$_SESSION['admin_user']]); $user=$stmt->fetch(); $msg='';
if($_SERVER['REQUEST_METHOD']==='POST' && ($_POST['action'] ?? '')==='changepass'){ if(!verify_csrf($_POST['csrf'] ?? '')) die('Invalid CSRF'); $current=$_POST['current'] ?? ''; $new=$_POST['new'] ?? ''; $confirm=$_POST['confirm'] ?? ''; if(!password_verify($current,$user['password'])) $msg='Current password is incorrect.'; elseif($new===''||strlen($new)<8) $msg='New password must be at least 8 characters.'; elseif($new!==$confirm) $msg='New password and confirmation do not match.'; else { $hash=password_hash($new,PASSWORD_DEFAULT); $pdo->prepare("UPDATE admin SET password=? WHERE id=?")->execute([$hash,$user['id']]); $msg='Password updated successfully.'; } }
?><!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Change Password</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Modern Luxury Theme -->
<link rel="stylesheet" href="assets/css/theme.css">
</head><body><div class="container py-4"><a href="dashboard.php">Â« Back</a><h3>Change Password</h3><?php if($msg): ?><div class="alert alert-info"><?=htmlspecialchars($msg)?></div><?php endif; ?><form method="post"><input type="hidden" name="csrf" value="<?=csrf_token()?>"><input type="hidden" name="action" value="changepass"><div class="mb-3"><label>Current password</label><input type="password" name="current" class="form-control" required></div><div class="mb-3"><label>New password</label><input type="password" name="new" class="form-control" required></div><div class="mb-3"><label>Confirm new password</label><input type="password" name="confirm" class="form-control" required></div><button class="btn btn-primary">Change Password</button></form></div>
<script src="assets/js/theme.js"></script>
</body></html>